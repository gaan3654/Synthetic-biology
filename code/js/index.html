<!DOCTYPE html>
<html>
<body>
    <script type="text/javascript" src='RKm.js'> </script>
    <title>Differential equation solver</title><meta charset="utf-8"/>
    <canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    <br>
    <script>
        //Sukuria input lauką intervalo pradžiai
        var body = document.getElementsByTagName("body")[0];
        var int_begins_name = document.createElement("text");
        int_begins_name.innerHTML = "Intervalo pradžia: ";
        body.appendChild(int_begins_name);
        var int_begins = document.createElement("input");
        int_begins.setAttribute("type", "number");
        int_begins.setAttribute("value", "0");
        body.appendChild(int_begins);

        //Sukuria input lauką intervalo pabaigai
        var body = document.getElementsByTagName("body")[0];
        var int_ends_name = document.createElement("text");
        int_ends_name.innerHTML = "Intervalo pabaiga: ";
        body.appendChild(int_ends_name);
        var int_ends = document.createElement("input");
        int_ends.setAttribute("type", "number");
        int_ends.setAttribute("value", "1");
        body.appendChild(int_ends);

        //Sukuria input lauką y0 reikšmei
        var body = document.getElementsByTagName("body")[0];
        var y0_name = document.createElement("text");
        y0_name.innerHTML = "Y0: ";
        body.appendChild(y0_name);
        var y0_inp = document.createElement("input");
        y0_inp.setAttribute("type", "number");
        y0_inp.setAttribute("value", "1");
        body.appendChild(y0_inp);

        //Sukuria input lauką N reikšmei
        var body = document.getElementsByTagName("body")[0];
        var n_name = document.createElement("text");
        n_name.innerHTML = "N: ";
        body.appendChild(n_name);
        var n_inp = document.createElement("input");
        n_inp.setAttribute("type", "number");
        n_inp.setAttribute("value", "100");
        body.appendChild(n_inp);


        //creates buton
        var button = document.createElement("button");
        button.innerHTML = "Submit";
        body.appendChild(button);
        


        //Runge–Kutta metodas
        function f(t,y){
            return y;
        }

        function k1(t, y, h){
            return h * f(t,y);
        }

        function k2(t, y, h, k1){
            return h * f(t+h/2,y+k1/2);
        }

        function k3(t, y, h, k2){
            return h * f(t+h/2,y+k2/2);
        }

        function k4(t, y, h, k3){
            return h * f(t+h,y+k3);
        }

        function solution(y0, a, b, N){
            var t=[];
            var y=[];
            y[0] = y0;
            t[0] = a;
            var h= (b-a)/N;
            for (var i=0; i < N; i++) {
                t[i+1] = t[i]+h;
                var kk1 = k1(t[i], y[i], h);
                var kk2 = k2(t[i], y[i], h, kk1);
                var kk3 = k3(t[i], y[i], h, kk2);
                var kk4 = k4(t[i], y[i], h, kk3);
                y[i+1] = y[i]+1/6*(kk1+2*kk2+2*kk3+kk4);
            } 
        return [y,t];
        }
        //Gautų rezultatų normalizavimas
        function normalization(yy,tt, a, b, height, width){
            var yp = [];
            var tp = [];
            var y_max=yy[0];
            var y_min=0;
            for(i=0; i<101; i++){
                //Jei y_min ir y_max sutampa tai if'ą
                if(y_max<yy[i]){
                    y_max=yy[i]
                }
                //yy normalizacija
                var k = 1/(y_max-y_min);
                var l = -y_min/(y_max-y_min);
                //tt normalizacija
                var kt = 1/(b-a);
                var lt = -a/(b-a);
            }
            for(i=0; i<101; i++){
                yp[i] = height-(k*yy[i]+l)*height;
                tp[i] = (kt*tt[i]+lt)*width;
            }
            return [yp,tp];
        }
        //Sukuriamas laukas grafikui
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        button.addEventListener("click", function(event) {
            var int_begin = parseInt(int_begins.value);
            var int_end = parseInt(int_ends.value);
            var y0 = parseInt(y0_inp.value);
            var N = parseInt(n_inp.value);
            console.log(int_begin);
            var [yy, tt] = solution(y0, int_begin, int_end, N);
            var [yp,tp] = normalization(yy, tt, int_begin, int_end, c.height, c.width);
            //Piešiamia kreivė
            ctx.moveTo(tp[0],yp[0]);
            for(i=1; i<N; i++){
                ctx.lineTo(tp[i],yp[i]); 
            }
            
            ctx.strokeStyle = "#0F00FF";
            ctx.stroke();   
        });
        //Nupiešiami sąsiyuvinio langeliai
        for(i=50; i<c.height; i+=50){
            ctx.moveTo(i,0);
            ctx.lineTo(i,c.width);     
            ctx.moveTo(0,i);
            ctx.lineTo(c.width,i);     
        }
        ctx.strokeStyle = "#CCE5FF";
        ctx.lineWidth = 0.5 ;
        ctx.stroke();   
        //Liko suformatuoti grafiką
        
  </script>
  
</body>
</html>