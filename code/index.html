<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src='js/draw_graph.js'> </script>
        <script type="text/javascript" src='js/runge-kutta-method.js'> </script>
        <script type="text/javascript" src='js/replace_symb_w_func.js'> </script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <link type="text/css" rel="stylesheet" href="style.css">
        <title>Differential equation solver</title><meta charset="utf-8"/>
    </head>
    <body>
        <header class="mainDetails ">
            <div class="mainDetails__photo">
                <img src="../assets/graph-logo.png" alt="Logo">
            </div>
            <div class="mainDetails__info">
                <h1>Diferencialinių lygčių sistemų sprendimas</h1>
                <h2>Paremta Runge-Kutta metodu</h2>
            </div>
            <div class="mainDetails__contact">
                <a href="mailto:gabriele.anuzyte@mif.stud.vu.lt">e: gabriele.anuzyte@mif.stud.vu.lt</a> <br>
                <a href="mailto:dominika.barilovic@mif.stud.vu.lt">e: dominika.barilovic@mif.stud.vu.lt</a> <br>
                <a href="http://vu.lt">w: www.vu.lt</a> <br>
            </div>    
        </header>
        <div>    
            <button id=info >Info</button>
            <div id="dialog">
                <br><strong>Sistemos naudojimas specifinėms funkcijoms.</strong><br><br>
                <ul>
                    <li>Trigonometrinės lygties pavyzdys:
                        <ul>
                            <li>cos(lygtis)</li>
                            <li>acos(lygtis)</li>
                        </ul>
                    </li>
                    <li>Šaknies traukimas:
                            <ul>
                                <li>sqrt(lygtis)</li>
                                <li>cbrt(lygtis)</li>
                            </ul>
                        </li>
                    </li>
                    <li>Kėlimui laipsniu:
                            <ul>
                                <li>pagrindas^laipsnis</li>
                            </ul>
                        </li>
                    </li>
                    <li>Logaritmai:
                            <ul>
                                <li>log(pagrindas,logaritmuojamas reiškinys</li>
                                <li>ln(lygtis)</li>
                            </ul>
                        </li>
                    </li>
                    <li>Konstantos:
                            <ul>
                                <li>pi</li>
                                <li>e</li>
                            </ul>
                        </li>
                    </li>
                </ul> 
            </div>
                
            <div id="substance_input">
                
                <div id=substance>  
                    <div class=input_blocks>
                        A:
                        <input type="text" id="subs0"> 
                        <input type="color" id="color0" class="s_colors" value="#ff0000">
                    </div>
                    <div class=input_blocks>
                        B:
                        <input type="text" id="subs1"> 
                        <input type="color" id="color1" class="s_colors" value="#0000ff">
                    </div>
                    <div class=input_blocks>
                        C:
                        <input type="text" id="subs2"> 
                        <input type="color" id="color2" class="s_colors" value="#00ff00">
                    </div>
                    <div id=count_subst>
                        Kiek medžiagų norite pridėti?
                        <input type="number" id="subs_counter" value="1">
                    </div>
                </div>
                

                <div id=inputs>
                    <div id=interv_begins class=input_blocks>
                        Intervalo pradžia: 
                        <input type="number" id="int_begins" value="0"> 
                    </div> 
                    
                    <div id=interv_ends class=input_blocks> 
                        Intervalo pabaiga:
                        <input type="number" id="int_ends" value="1"> 
                    </div>
                    
                    <div id=y0 class=input_blocks>
                        y0:               
                        <input type="number" id="y0_inp" value="1"> 
                    </div> 
                    
                    <div id=N class=input_blocks>
                        N:                
                        <input type="number" id="n_inp" value="100"> 
                    </div>   
                    <div id=reaction class=input_blocks>
                        Įveskite norimą reakciją:
                        <input type="text" id="reaction" value="A+B->0">
                    </div>
                 </div>

                
            </div>
          
            
            <div class="subs_react_buttons">
            <button id=add_subs>Pridėti medžiagą(as)</button>
            <button id=submit_reaction>Vykdyti reakciją(as)</button>
            </div>

            <div id="all_inputs">                    
                <div id=function>
                    <div id=f class=input_blocks>
                        Funkcija f(t,y):
                        <input type="text" id="func0" value="log(t,5)">
                        <!--<input type="color" id="color0" class="f_colors" value="#ff0000">-->
                    </div>         
                </div>
            </div>

            <div class="visimygtukai">
                <div id=dumygtukai>
                    <button id=submit>Piešti grafiką</button>
                    <button id=delete>Išvalyti grafiką</button>
                </div>
            </div>

            <div id=canvas class=canvas>
                <canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;">
                    Your browser does not support the HTML5 canvas tag.
                </canvas>
            </div>

        </div>

        <script>
            //jQuery pranešimui gauti
            $(document).ready(function() {
            $(function() {
                $( "#dialog" ).dialog({
                    autoOpen: false,
                    title: 'Info',
                    width: 500,
                    height: 300,
                    show: {
                        effect: "slide",
                        duration: 1000
                    },
                    hide: {
                        effect: "fade",
                        duration: 1000
                    }
                    
                });
            });

            $("#info").click(function(){
                    $( "#dialog" ).dialog('open');
                });
            }); 

            //Sukuriamas laukas grafikui
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            draw(ctx);

            //Kreivių piešimas
            document.getElementById("submit").addEventListener("click", function(event) {
                var int_begin = parseFloat(document.getElementById("int_begins").value);
                var int_end = parseFloat(document.getElementById("int_ends").value);
                var y0 = parseInt(document.getElementById("y0_inp").value);
                var N = parseInt(document.getElementById("n_inp").value);

                for(j=0; j<func_names.length; j++){
                    //Apskaičiuojami kiekvienos funkcijos taškai
                    var funct = document.getElementById(func_names[j]).value;
                    funct = replace_symbols(funct);
                    
                    var f_color = document.getElementById(func_color_id[j]).value;
                    var [yy, tt] = solution(y0, int_begin, int_end, N, funct);
                    var [y_norm,t_norm, y_max] = normalization(yy, tt, int_begin, int_end, N, c.height, c.width);
                    //Piešiamia kreivė
                    ctx.beginPath();
                    ctx.moveTo(t_norm[0],y_norm[0]);
                    for(p=1; p<=N; p++){
                        ctx.lineTo(t_norm[p],y_norm[p]);
                        //console.log(y_norm[p]);
                    }
                    ctx.strokeStyle = f_color;
                    ctx.stroke(); 
                }
                //Piešiami skičiai prie grafiko ašių
                axle_numbers(N, y_max, int_end);

                // alertai
                /*var funct_count = parseInt(document.getElementById("subs_counter").value);
                for(i=0; i<funct_count+1; i++){
                    var value = document.getElementById("func"+i).value ;
                    // iškviečiamas alert laukas jei nįšvesta funkcija
                    if(value.trim() == "") {
                        alert("Error: Tuščias įvesties laukas!");
                        return false;
                    }
                    //iškviečiamas alert laukas jei įvesta netinkama funkcija
                    //Reikia pakeisti, kad tikrintu rezultatų egzistavimą, o ne įvestą funkciją.
                    if(value.trim() == "y/t") {
                        alert("Error: Funkcija y/t neegzistuoja!");
                        return false;
                    }
                    else{
                        return true;
                    }
                }*/
                    
            });

            var subs_names = ["subs0","subs1","subs2"];
            var subs_color_id = ["color0", "color1", "color2"];
            var subs_color = ["#ff0000", "#0000ff", "#00ff00", "#990099", "#ffff00", "#ff9900"];
            var subs_html_name = ["A","B","C","D","E","F","G","H"];
             //Prideda papildomą medžiagos input lauką
             document.getElementById("add_subs").addEventListener("click", function(event){
                var d = document.getElementById("substance");
                var subs_count = parseInt(document.getElementById("subs_counter").value);
                var substance_count = subs_color_id.length+subs_count;
                for(i=subs_color_id.length; i<substance_count; i++){
                    console.log(i);
                    subs_names[i] = "subs"+i;
                    subs_color_id[i] = "color"+i;
                    //Išnaudojus nustatytas spalvas, jos funkcijoms priskiriamos atsitiktinai
                    if(subs_color[i] == null){
                        subs_color[i] = getRandomColor();
                        //Tikrinama ar tokia spalva jau nėra priskirta
                        for(j=0; j<subs_color.length-1; j++){
                            if(subs_color[i]==subs_color[j]){
                                subs_color[i] = getRandomColor();
                                j = 0;
                            }
                        }
                    }
                    //Pridedami įvesties laukai papildomoms funkcijoms
                    d.innerHTML += 
                    `<div class=input_blocks>
                        ${subs_html_name[i]}: <input id=${subs_names[i]} type='text'>
                        <input type="color" id=${subs_color_id[i]} class="s_colors" value=${subs_color[i]}>
                    </div>`;

                    //išvalome pridėti funkcijos mygtuką ir įvesties lauką.
                    var button = document.getElementById("add_subs")
                    button.style.display = 'none'
                    var counter_input_field = document.getElementById("count_subst")
                    counter_input_field.style.display = 'none'


                }
            });


            //Išvalo grafiką
            //var funct_count = parseInt(document.getElementById("func_counter").value);
            document.getElementById("delete").addEventListener("click", function(event){
                ctx.clearRect(0,0, c.width, c.height )
                ctx.beginPath();
                draw(ctx);
                //pridedame pridėti funkcijos mygtuką ir įvesties lauką.
                /*for(i=1; i<funct_count+1; i++){
                var button = document.getElementById("add_func")
                button.style.display = 'block'
                var sk = document.getElementById("sk")
                sk.style.display = 'block'

                //reikia kažkaip padaryti kad ištrintų papildomus įvesties laukus
                }*/
            });           
        </script>
    </body>
</html>