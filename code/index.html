<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src='js/draw_graph.js'> </script>
        <script type="text/javascript" src='js/runge-kutta-method.js'> </script>
        <script type="text/javascript" src='js/replace_symb_w_func.js'> </script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <link type="text/css" rel="stylesheet" href="style.css">
        <title>Differential equation solver</title><meta charset="utf-8"/>
    </head>
    <body>
        <header class="mainDetails ">
            <div class="mainDetails__photo">
                <img src="../assets/graph-logo.png" alt="Logo">
            </div>
            <div class="mainDetails__info">
                <h1>Diferencialinių lygčių sistemų sprendimas</h1>
                <h2>Paremta Runge-Kutta metodu</h2>
            </div>
            <div class="mainDetails__contact">
                <a href="mailto:gabriele.anuzyte@mif.stud.vu.lt">e: gabriele.anuzyte@mif.stud.vu.lt</a> <br>
                <a href="mailto:dominika.barilovic@mif.stud.vu.lt">e: dominika.barilovic@mif.stud.vu.lt</a> <br>
                <a href="http://vu.lt">w: www.vu.lt</a> <br>
            </div>    
        </header>
        <div>    
            <button id=info >Info</button>
            <div id="dialog">
                <br><strong>Sistemos naudojimas specifinėms funkcijoms.</strong><br><br>
                <ul>
                    <li>Trigonometrinės lygties pavyzdys:
                        <ul>
                            <li>cos(lygtis)</li>
                            <li>acos(lygtis)</li>
                        </ul>
                    </li>
                    <li>Šaknies traukimas:
                            <ul>
                                <li>sqrt(lygtis)</li>
                                <li>cbrt(lygtis)</li>
                            </ul>
                        </li>
                    </li>
                    <li>Kėlimui laipsniu:
                            <ul>
                                <li>pagrindas^laipsnis</li>
                            </ul>
                        </li>
                    </li>
                    <li>Logaritmai:
                            <ul>
                                <li>log(pagrindas,logaritmuojamas reiškinys</li>
                                <li>ln(lygtis)</li>
                            </ul>
                        </li>
                    </li>
                    <li>Konstantos:
                            <ul>
                                <li>pi</li>
                                <li>e</li>
                            </ul>
                        </li>
                    </li>
                </ul> 
            </div>

            <div class="chemical_functions">
                    <button id=chemf1>Osciliacija</button>
                    <button id=chemf2>Funkcija 2</button>
                    <button id=chemf3>Funkcija 3</button>
                    <button id=chemf4>Funkcija 4</button>
                    <button id=chemf5>Funkcija 5</button>
                    <button id=chemf6>Funkcija 6</button>
                    <button id=chemf7>Funkcija 7</button>
                    <button id=chemf8>Funkcija 8</button>
                    <button id=chemf9>Funkcija 9</button>
                    <button id=chemf10>Funkcija 10</button>
                    <button id=chemf11>Funkcija 11</button>
                    <button id=chemf12>Funkcija 12</button>
                </div>

            <div id="all_inputs">                    
                <div id=function>
                    <div id=f class=input>
                        Funkcija f(t,y):
                        <input type="text" id="func0" value="log(t,5)">
                        <input type="color" id="color0" class="f_colors" value="#ff0000">
                    </div>         
                    
                    <div id=sk class=input>
                        Kiek funkcijų pridėti?
                        <input type="number" id="func_counter" value="1">
                    </div> 
                </div>
            
                <div id=inputs>
                    <div id=interv_begins class=input>
                        Intervalo pradžia: 
                        <input type="number" id="int_begins" value="0"> 
                    </div> 
                
                    <div id=interv_ends class=input> 
                        Intervalo pabaiga:
                        <input type="number" id="int_ends" value="1"> 
                    </div>
                
                    <div id=y0 class=input>
                        y0:               
                        <input type="number" id="y0_inp" value="1"> 
                    </div> 
                
                    <div id=N class=input>
                        N:                
                        <input type="number" id="n_inp" value="100"> 
                    </div>
                
                    
                </div>
                
            </div>

            <div class="visimygtukai">
                <!-- <div id=button class=input> -->
                <div id=button>
                    <button id=add_func>Pridėti funkciją(as)</button>
                </div>
                <!-- <div id=dumygtukai class=input> -->
                <div id=dumygtukai>
                    <button id=submit>Piešti grafiką</button>
                    <button id=delete>Išvalyti grafiką</button>
                </div>
            </div>

            <div id=canvas class=canvas>
                <canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;">
                    Your browser does not support the HTML5 canvas tag.
                </canvas>
            </div>

        </div>

        <script>
            //jQuery pranešimui gauti
            $(document).ready(function() {
            $(function() {
                $( "#dialog" ).dialog({
                    autoOpen: false,
                    title: 'Info',
                    width: 500,
                    height: 300,
                    show: {
                        effect: "slide",
                        duration: 1000
                    },
                    hide: {
                        effect: "fade",
                        duration: 1000
                    }
                    
                });
            });

            $("#info").click(function(){
                    $( "#dialog" ).dialog('open');
                });
            }); 

            //Sukuriamas laukas grafikui
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            draw(ctx);
            //Kintamieji funkcijų grafikų piešimui
            var func_names = ["func0"];
            var func_color_id = ["color0"];
            var func_color = ["#ff0000", "#0000ff", "#00ff00", "#990099", "#ffff00", "#ff9900"];


            //pavyzdinės cheminės reakcijos, kurias užrašome kaip matematines funkcijas
            //osciliacija pvz gal ne visai gerai
            $('#chemf1').click(function(){
             $('#func0').val('1/2*cos(t)+3*sin(t)');
             $('#int_ends').val('13');
            });

            //konversija 'A + E -k> B + E'
            $('#chemf2').click(function(){
            $('#func_counter').val('2');
             $('#func0').val('(-k * A * E)');
             $('#func1').val('(k * A * E)*t');
             $('#func2').val('0');
             $('#int_ends').val('25');
            });


            //Kreivių piešimas
            document.getElementById("submit").addEventListener("click", function(event) {
                var int_begin = parseFloat(document.getElementById("int_begins").value);
                var int_end = parseFloat(document.getElementById("int_ends").value);
                var y0 = parseInt(document.getElementById("y0_inp").value);
                var N = parseInt(document.getElementById("n_inp").value);

                for(j=0; j<func_names.length; j++){
                    //Apskaičiuojami kiekvienos funkcijos taškai
                    var funct = document.getElementById(func_names[j]).value;
                    funct = replace_symbols(funct);
                    
                    var f_color = document.getElementById(func_color_id[j]).value;
                    var [yy, tt] = solution(y0, int_begin, int_end, N, funct);
                    var [y_norm,t_norm] = normalization(yy, tt, int_begin, int_end, N, c.height, c.width);
                    //Piešiamia kreivė
                    ctx.beginPath();
                    ctx.moveTo(t_norm[0],y_norm[0]);
                    for(p=1; p<=N; p++){
                        ctx.lineTo(t_norm[p],y_norm[p]);
                        //console.log(y_norm[p]);
                    }
                    ctx.strokeStyle = f_color;
                    ctx.stroke(); 
                }

                //skaičiai ant ašies OY
                var i=40;
                //čia mano logika intervalų skaičiukų nustatymui. 
                //jei turime [y_norm[1], y_norm[100]], t.y N=100
                //ir turime 20 langelių, tačiau piešiame kas antram, tai gaunas kad reikia tik 10 reikšmių
                //tai čia paimu y_norm[10]; y_norm[20]; y_norm[30], ..., y_norm[100]
                //reikia man pagalvoti kaip bus su skirtingais N...
                for(p=N/10; p<N; p+=N/10){ 
                    var oy_number=(y_norm[p]);  
                    oy_number = oy_number.toFixed(0);  //suapvalinu iki skaičių be kablelio
                     //console.log(oy_number); 
                    ctx.font = "9px sans-serif";
                    ctx.fillText(oy_number, 0 ,c.height-i);
                    i+=40; 
                }       
                

                //skaičiai ant ašies OX
                for(i=40; i<c.width; i+=40){
                    var ox_number = int_end/20; //intervalo ilgį dalinu iš 20 nes yra 20 langelių
                    ox_number = ox_number.toFixed(2); //suapvalinu iki dviejų skaičių po kablelio
                    ctx.font = " 10px sans-serif";
                    ctx.fillText(ox_number*i/20, (i+20)-5,c.width-4 ); //i+20 kad pradėtų piešti nuo 60 langelio
                    //ox_number*i, kad didėtų reikšmės tolygiai ties kiekvienu langeliu
                    
                }

                // alertai
                var funct_count = parseInt(document.getElementById("func_counter").value);
                for(i=0; i<funct_count+1; i++){
                    var value = document.getElementById("func"+i).value ;
                    // iškviečiamas alert laukas jei nįšvesta funkcija
                    if(value.trim() == "") {
                        alert("Error: Tuščias įvesties laukas!");
                        return false;
                    }
                    //iškviečiamas alert laukas jei įvesta netinkama funkcija
                    if(value.trim() == "y/t") {
                        alert("Error: Funkcija y/t neegzistuoja!");
                        return false;
                    }
                    else{
                        return true;
                    }
                }
                    
            });
            
            //Prideda papildomą funkcijos input lauką
            document.getElementById("add_func").addEventListener("click", function(event){
                var d = document.getElementById("function");
                var funct_count = parseInt(document.getElementById("func_counter").value);
                
                for(i=1; i<funct_count+1; i++){
                    func_names[i] = "func"+i;
                    func_color_id[i] = "color"+i;
                    //Išnaudojus nustatytas spalvas, jos funkcijoms priskiriamos atsitiktinai
                    if(func_color[i] == null){
                        func_color[i] = getRandomColor();
                        //Tikrinama ar tokia spalva jau nėra priskirta
                        for(j=0; j<func_color.length-1; j++){
                            if(func_color[i]==func_color[j]){
                                func_color[i] = getRandomColor();
                                j = 0;
                            }
                        }
                    }
                    //Pridedami įvesties laukai papildomoms funkcijoms
                    d.innerHTML += 
                    `<div class=input>
                        Funkcija f(t,y): <input id=${func_names[i]} type='text' value='y+t'>
                        <input type="color" id=${func_color_id[i]} class="f_colors" value=${func_color[i]}>
                    </div>`;

                    //išvalome pridėti funkcijos mygtuką ir įvesties lauką.
                    var button = document.getElementById("add_func")
                    button.style.display = 'none'
                    var sk = document.getElementById("sk")
                    sk.style.display = 'none'


                }
            });

            //Išvalo grafiką
            var funct_count = parseInt(document.getElementById("func_counter").value);
            document.getElementById("delete").addEventListener("click", function(event){
                ctx.clearRect(0,0, c.width, c.height )
                ctx.beginPath();
                draw(ctx);
                //pridedame pridėti funkcijos mygtuką ir įvesties lauką.
                for(i=1; i<funct_count+1; i++){
                var button = document.getElementById("add_func")
                button.style.display = 'block'
                var sk = document.getElementById("sk")
                sk.style.display = 'block'

                //reikia kažkaip padaryti kad ištrintų papildomus įvesties laukus
                }
            });           
        </script>
    </body>
</html>