<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">

body {
	margin: 0;
}

canvas {
    display: block;
    margin: 40px auto;
}

</style>

</head>

<body>

<canvas id="my-canvas" width="1000" height="1000"></canvas>

<script type="text/javascript" charset="utf-8">

//Sukuria input lauką intervalo pradžiai
var body = document.getElementsByTagName("body")[0];
        var int_begins_name = document.createElement("text");
        int_begins_name.innerHTML = "Intervalo pradžia: ";
        body.appendChild(int_begins_name);
        var int_begins = document.createElement("input");
        int_begins.setAttribute("type", "number");
        int_begins.setAttribute("value", "0");
        body.appendChild(int_begins);
        //creates buton
        var button = document.createElement("button");
        button.innerHTML = "Submit";
        body.appendChild(button);
        
        //Runge–Kutta metodas
        var y0 = 1;
        function f(t,y){
            return y;
        }
        function k1(t, y, h){
            return h * f(t,y);
        }
        function k2(t, y, h, k1){
            return h * f(t+h/2,y+k1/2);
        }
        function k3(t, y, h, k2){
            return h * f(t+h/2,y+k2/2);
        }
        function k4(t, y, h, k3){
            return h * f(t+h,y+k3);
        }
        function solution(y0, a, b, N){
            var t=[];
            var y=[];
            y[0] = y0;
            t[0] = a;
            var h= (b-a)/N;
            for (var i=0; i < N; i++) {
                t[i+1] = t[i]+h;
                var kk1 = k1(t[i], y[i], h);
                var kk2 = k2(t[i], y[i], h, kk1);
                var kk3 = k3(t[i], y[i], h, kk2);
                var kk4 = k4(t[i], y[i], h, kk3);
                y[i+1] = y[i]+1/6*(kk1+2*kk2+2*kk3+kk4);
            } 
        return [y,t];
        }
        //Gautų rezultatų normalizavimas
        function normalization(yy,tt, a, b, height, width){
            var yp = [];
            var tp = [];
            var y_max=yy[0];
            var y_min=0;
            for(i=0; i<101; i++){
                //Jei y_min ir y_max sutampa tai if'ą
                if(y_max<yy[i]){
                    y_max=yy[i]
                }
                //yy normalizacija
                var k = 1/(y_max-y_min);
                var l = -y_min/(y_max-y_min);
                //tt normalizacija
                var kt = 1/(b-a);
                var lt = -a/(b-a);
            }
            for(i=0; i<101; i++){
                yp[i] = height-(k*yy[i]+l)*height;
                tp[i] = (kt*tt[i]+lt)*width;
            }
            return [yp,tp];
        }



//sukuriamas grafikas

var grid_size = 25;
var x_axis_distance_grid_lines = 19;
var y_axis_distance_grid_lines = 1;
var x_axis_starting_point = { number: 1, suffix: '' };
var y_axis_starting_point = { number: 1, suffix: '' };

var canvas = document.getElementById("my-canvas");
var ctx = canvas.getContext("2d");

var canvas_width = canvas.width;
var canvas_height = canvas.height;




var num_lines_x = Math.floor(canvas_height/grid_size);
var num_lines_y = Math.floor(canvas_width/grid_size);

// Draw grid lines along X-axis
for(var i=0; i<=num_lines_x; i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    
    // If line represents X-axis draw in different color
    if(i == x_axis_distance_grid_lines) 
        ctx.strokeStyle = "#000000";
    else
        ctx.strokeStyle = "#e9e9e9";
    
    if(i == num_lines_x) {
        ctx.moveTo(0, grid_size*i);
        ctx.lineTo(canvas_width, grid_size*i);
    }
    else {
        ctx.moveTo(0, grid_size*i+0.5);
        ctx.lineTo(canvas_width, grid_size*i+0.5);
    }
    ctx.stroke();
}

// Draw grid lines along Y-axis
for(i=0; i<=num_lines_y; i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    
    // If line represents X-axis draw in different color
    if(i == y_axis_distance_grid_lines) 
        ctx.strokeStyle = "#000000";
    else
        ctx.strokeStyle = "#e9e9e9";
    
    if(i == num_lines_y) {
        ctx.moveTo(grid_size*i, 0);
        ctx.lineTo(grid_size*i, canvas_height);
    }
    else {
        ctx.moveTo(grid_size*i+0.5, 0);
        ctx.lineTo(grid_size*i+0.5, canvas_height);
    }
    ctx.stroke();
}

// Translate to the new origin. Now Y-axis of the canvas is opposite to the Y-axis of the graph. So the y-coordinate of each element will be negative of the actual
ctx.translate(y_axis_distance_grid_lines*grid_size, x_axis_distance_grid_lines*grid_size);

// Ticks marks along the positive X-axis
for(i=1; i<(num_lines_y - y_axis_distance_grid_lines); i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#000000";

    // Draw a tick mark 6px long (-3 to 3)
    ctx.moveTo(grid_size*i+0.5, -3);
    ctx.lineTo(grid_size*i+0.5, 3);
    ctx.stroke();

    // Text value at that point
    ctx.font = '9px Arial';
    ctx.textAlign = 'start';
    ctx.fillText(x_axis_starting_point.number*i + x_axis_starting_point.suffix, grid_size*i-2, 15);
}

// Ticks marks along the negative X-axis
for(i=1; i<y_axis_distance_grid_lines; i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#000000";

    // Draw a tick mark 6px long (-3 to 3)
    ctx.moveTo(-grid_size*i+0.5, -3);
    ctx.lineTo(-grid_size*i+0.5, 3);
    ctx.stroke();

    // Text value at that point
    ctx.font = '9px Arial';
    ctx.textAlign = 'end';
    ctx.fillText(-x_axis_starting_point.number*i + x_axis_starting_point.suffix, -grid_size*i+3, 15);
}

// Ticks marks along the positive Y-axis
// Positive Y-axis of graph is negative Y-axis of the canvas
for(i=1; i<(num_lines_x - x_axis_distance_grid_lines); i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#000000";

    // Draw a tick mark 6px long (-3 to 3)
    ctx.moveTo(-3, grid_size*i+0.5);
    ctx.lineTo(3, grid_size*i+0.5);
    ctx.stroke();

    // Text value at that point
    ctx.font = '9px Arial';
    ctx.textAlign = 'start';
    ctx.fillText(-y_axis_starting_point.number*i + y_axis_starting_point.suffix, 8, grid_size*i+3);
}

// Ticks marks along the negative Y-axis
// Negative Y-axis of graph is positive Y-axis of the canvas
for(i=1; i<x_axis_distance_grid_lines; i++) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#000000";

    // Draw a tick mark 6px long (-3 to 3)
    ctx.moveTo(-3, -grid_size*i+0.5);
    ctx.lineTo(3, -grid_size*i+0.5);
    ctx.stroke();

    // Text value at that point
    ctx.font = '9px Arial';
    ctx.textAlign = 'start';
    ctx.fillText(y_axis_starting_point.number*i + y_axis_starting_point.suffix, 8, -grid_size*i+3);
}

button.addEventListener("click", function(event) {
            var int_begin = parseInt(int_begins.value);
            console.log(typeof int_begin);
            var [yy, tt] = solution(y0, /*int_begin*/0, 1, 100);
            var [yp,tp] = normalization(yy, tt, /*int_begin*/0, 1, canvas.height, canvas.width);
            console.log(yp[0]);
            //Piešiamia kreivė
            
            ctx.moveTo(tp[0],yp[0]);
            
            for(i=1; i<100; i++){
                
                ctx.lineTo(tp[i],yp[i]); 
            }
            
            ctx.strokeStyle = "#0F00FF";
            ctx.stroke();   
        });

</script>
</body>

</html>
